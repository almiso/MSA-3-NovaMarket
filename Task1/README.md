# Task 1: Проектирование приложения на базе EDA (Saga Choreography)

В данной директории представлены артефакты проектирования микросервисной платформы NovaMarket на базе событийно-ориентированной архитектуры (Хореография через Apache Kafka).

## Архитектурные Решения и Сервисы

Платформа декомпозирована на специализированные микросервисы (по сравнению с базовым набором выделены `Cart`, `OMS` и `OrderHistory`):

- **Cart Service**: Отвечает исключительно за жизненный цикл корзины, быструю работу со списком товаров и предварительную валидацию до оформления (pre-checkout).
- **OMS (Order Management System)**: Сервис-инициатор Saga. Содержит State-машину активных заказов, слушает события (оплаты, резерва) и переключает состояния. Не хранит долгую историю, сфокусирован на процессинге (Processing).
- **OrderHistory Service**: Вынесенный микросервис, который подписывается на терминальные события (Успешная доставка, Отмена) и сохраняет read-репрезентацию заказа для просмотра пользователем своей длительной истории. Снижает нагрузку на БД `OMS`.
- **Inventory Service**: Управляет фактическими остатками, обрабатывает резервы и компенсации, а также предоставляет быстрый endpoint для предварительной валидации товара при добавлении в корзину.
- **Payment, Logistics, Catalog, Notification**: Стандартные сервисы, отвечающие за узкие доменные области продукта.

## Артефакты (Содержимое)

1. **C2_diagram.puml]**
   Контейнерная архитектурная диаграмма (нотация C4). Описывает микросервисы и потоки данных через Message Broker.

2. **saga_events_registry.md**
   Реестр событий для Saga-хореографии. Представлены `domain`, `failure` и `compensation` события, связанные с OMS и Inventory.

3. **sequence_success.puml**
   Sequence-диаграмма (UML) **успешного** сценария заказа. Включает шаг предварительной работы с корзиной (Cart → Inventory) до создания заказа в OMS.

4. **sequence_failure.puml**
   Sequence-диаграмма (UML) **ошибочного** сценария (ошибка оплаты) и компенсационных семантик (откат резерва на Складе, запись в Историю).

### Обоснование выбора архитектуры
Выбран вариант **"Хореография на базе Apache Kafka"**.
Такой подход обладает слабым зацеплением (Decoupling). Это позволяет разделить ответственность: корзина (Cart) валидирует быстро, OMS планомерно собирает события с остальных доменов, а новые сервисы (например, OrderHistory или сервисы Лояльности/Аналитики) могут просто подписаться на уже существующие топики брокера (например, `DeliveryScheduled`). Это отвечает требованиям бизнеса по масштабируемости до 40,000+ заказов в день без блокировки старого функционала.
